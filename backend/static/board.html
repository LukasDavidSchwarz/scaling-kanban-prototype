<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Kanban board</title>
</head>
<body onload="loaded()">
<label for="board-content">Content: </label><textarea id="board-content"></textarea>
<script>
    async function loaded() {
        const contentTextArea = document.getElementById('board-content');

        const urlParams = new URLSearchParams(window.location.search);
        const boardId = urlParams.get('boardId');
        if (boardId === null) {
            console.error('Failed to retrieve board_id query parameter!');
            return;
        }

        let response = await fetch(`/board/${boardId}`);
        let board = await response?.json();
        console.log(`Board ${boardId}:`, board);
        contentTextArea.value = board.name;

        const socket = new WebSocket(`ws://0.0.0.0:3512/board/${boardId}/watch`);
        socket.addEventListener('open', event => {
            console.log('web socket opened!');
        });

        socket.addEventListener('message', event => {
            console.log('Received data:', event.data);
            board = JSON.parse(event.data);
            contentTextArea.value = board.name;
        });

        contentTextArea.addEventListener('change', async event => {
            board.name = event.target.value;
            const requestBody = JSON.stringify(board);

            let response = await fetch(`/board/${boardId}`, {
                method: 'PUT',
                body: requestBody,
                headers: {
                    "Content-Type": "application/json",
                }
            });
            console.log(`PUT returned:`, response);
        });
    }</script>
</body>
</html>